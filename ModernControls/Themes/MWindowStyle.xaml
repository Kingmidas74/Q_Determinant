<ResourceDictionary 
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:ModernControls">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/ModernControls;component/Themes/MColors.xaml" />
        <ResourceDictionary Source="/ModernControls;component/Themes/FontsStyle.xaml" />
        <ResourceDictionary Source="/ModernControls;component/Themes/MTitleBarButtonStyle.xaml" />
        <ResourceDictionary Source="/ModernControls;component/Themes/MStatusBarStyle.xaml" />
    </ResourceDictionary.MergedDictionaries>
    
    
    <Style x:Key="{x:Type local:MWindow}" TargetType="{x:Type local:MWindow}">
        <Setter Property="SnapsToDevicePixels" Value="true" />
        <Setter Property="AllowsTransparency" Value="true" />
        <Setter Property="WindowStyle" Value="None" />
        <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
        <Setter Property="ResizeMode" Value="CanResizeWithGrip" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:MWindow}" >
                    <Grid TextOptions.TextRenderingMode="ClearType" TextOptions.TextFormattingMode="Display" Margin="7" Background="{TemplateBinding Background }">
                        <Grid.Effect>
                            <DropShadowEffect Color="{StaticResource ActionBrushColor}" Opacity="0.5" BlurRadius="7" ShadowDepth="2" Direction="315"/>
                        </Grid.Effect>
                        <Border x:Name="PART_Border" BorderThickness="0.5" BorderBrush="{StaticResource ActionColorBrush}">
                            <DockPanel HorizontalAlignment="Stretch" Background="Transparent" VerticalAlignment="Stretch">
                                <StatusBar
                                    DockPanel.Dock="Bottom" Height="24" x:Name="StatusBar">
                                    <TextBlock Margin="3,0,0,0" Text="{Binding StatusContent, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" Style="{StaticResource BaseFont}"/>
                                    <StatusBarItem HorizontalAlignment="Right">
                                        <ResizeGrip Opacity="0.75" />
                                    </StatusBarItem>
                                </StatusBar>
                                <Border
                                    x:Name="TitleBar"
                                    DockPanel.Dock="Top"
                                    BorderThickness="0" 
                                    Background="Transparent"
                                    >
                                    <Grid VerticalAlignment="Center" Height="30">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="40"/>
                                            <ColumnDefinition />
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="30"/>
                                            <ColumnDefinition Width="30"/>
                                        </Grid.ColumnDefinitions>
                                        <Path Width="30" Height="30" Margin="-20,-20,0,0" Stretch="Fill" Fill="{StaticResource ErrorFontColorBrush}" Data="F1 M 30.351,23.3949L 38.0169,19L 45.679,23.4244C 45.3991,23.8942 45.1188,24.364 44.8338,24.8309L 38.013,20.9065C 35.7412,22.216 33.4687,23.5251 31.1941,24.8298L 30.351,23.3949 Z M 33.2788,25.9482L 37.982,23.0164L 42.691,25.9458L 42.2196,26.6994L 39.8535,25.331C 39.6,27.7058 39.3291,30.0798 39.0822,32.4544C 40.1354,33.0708 41.1944,33.6778 42.2507,34.2898L 48.0344,30.0592L 45.6707,28.6901C 45.8087,28.4294 45.94,28.1645 46.0811,27.9054C 47.7098,28.7809 49.3427,29.6484 50.9705,30.5251L 50.7839,36.0726L 49.9052,36.0392L 49.9052,33.3032L 43.3427,36.1976L 43.3427,39.8346L 49.9048,42.7275L 49.9048,39.9911L 50.7831,39.96C 50.8475,41.8096 50.9116,43.6596 50.9689,45.5096L 46.0788,48.1261C 45.9443,47.863 45.8039,47.6029 45.6719,47.3387C 46.4612,46.8858 47.2471,46.4274 48.0348,45.9718L 42.2196,41.7106L 39.0465,43.546L 39.8539,50.7001L 42.2204,49.3321L 42.691,50.0841L 38.0169,53.0139L 33.2784,50.0833L 33.7506,49.3309L 36.1458,50.7001L 36.9194,43.5436C 36.9331,43.5062 36.8891,43.4977 36.8674,43.4819L 33.7804,41.7106L 27.9651,45.9722L 30.3294,47.3717L 29.8902,48.156C 28.269,47.2844 26.6475,46.4137 25.0295,45.5366C 25.0805,43.6875 25.1305,41.8383 25.1859,39.9891L 26.0897,40.0217L 26.0897,42.7617L 32.6574,39.8645L 32.6569,36.1976L 26.0897,33.3016L 26.0897,36.04L 25.1859,36.0726C 25.132,34.2329 25.0774,32.3923 25.031,30.5526L 29.8887,27.9062L 30.3294,28.6901L 27.9644,30.0592L 33.7187,34.2895C 34.7848,33.6775 35.8544,33.0708 36.9174,32.4544C 36.6705,30.0798 36.3997,27.7058 36.1461,25.331L 33.7501,26.699C 33.5897,26.4505 33.4361,26.1982 33.2788,25.9482 Z M 21.5461,28.4939C 24.0993,27.0241 26.6506,25.5504 29.2007,24.075C 29.4893,24.5401 29.7676,25.0122 30.0455,25.4835L 23.1948,29.4385L 23.194,37.3156L 21.5438,37.316C 21.5454,34.3752 21.5411,31.4343 21.5461,28.4939 Z M 45.9829,25.5137L 46.8257,24.0753C 49.3698,25.5464 51.9089,27.0253 54.4538,28.4939C 54.459,31.4343 54.4547,34.3752 54.4563,37.316L 52.8059,37.3156L 52.8052,29.4385L 45.9829,25.5137 Z M 21.5438,38.653L 23.1944,38.653L 23.1944,46.5233C 25.5385,47.898 28.0139,49.3129 30.0475,50.4855L 29.2066,51.923C 26.6502,50.456 24.1017,48.974 21.5457,47.5053C 21.5414,44.5546 21.5446,41.604 21.5438,38.653 Z M 52.8055,38.653L 54.4559,38.653C 54.4551,41.604 54.459,44.555 54.4539,47.5057C 51.9089,48.9747 49.3699,50.4537 46.8257,51.9246L 45.9829,50.4863C 48.2554,49.1638 50.5381,47.8532 52.804,46.5233L 52.8055,38.653 Z M 30.3513,52.5757L 31.1953,51.1377L 38.013,55.093L 44.8349,51.1377L 45.679,52.5757L 38.0169,57L 30.3513,52.5757 Z "/>
                                        <TextBlock x:Name="Caption" Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0"
                                                         Opacity="1" Style="{StaticResource BaseFont}"
                                                       Text="{Binding Title, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                       />
<!--
                                        <Button x:Name="SettingsButton"  Grid.Column="2" Style="{StaticResource MTitleBarButtonStyle}"
                                                Visibility="{Binding WithASide, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}">
                                            <Path Width="20" Height="20" Stretch="Fill" Fill="White" Data="F1 M 38,34.8333C 39.7489,34.8333 41.1667,36.2511 41.1667,38C 41.1667,39.7489 39.7489,41.1667 38,41.1667C 36.2511,41.1667 34.8333,39.7489 34.8333,38C 34.8333,36.2511 36.2511,34.8333 38,34.8333 Z M 39.0926,27.7941L 44.1899,23.4223C 45.1468,23.8291 46.0554,24.3274 46.9048,24.9062L 45.9892,31.5559L 52.685,32.0689C 53.068,33.0162 53.362,34.009 53.5566,35.037L 48.2059,39.0926L 52.5777,44.1899C 52.1709,45.1468 51.6726,46.0554 51.0938,46.9048L 44.4441,45.9892L 43.9311,52.685C 42.9838,53.068 41.9909,53.3619 40.963,53.5565L 36.9074,48.2059L 31.8101,52.5777C 30.8532,52.1709 29.9446,51.6726 29.0952,51.0938L 30.0108,44.4441L 23.315,43.931C 22.932,42.9837 22.638,41.9909 22.4434,40.963L 27.7941,36.9074L 23.4223,31.8101C 23.8291,30.8532 24.3274,29.9446 24.9062,29.0952L 31.5559,30.0108L 32.0689,23.315C 33.0162,22.932 34.0091,22.638 35.037,22.4434L 39.0926,27.7941 Z M 38,31.6667C 34.5022,31.6667 31.6667,34.5022 31.6667,38C 31.6667,41.4978 34.5022,44.3333 38,44.3333C 41.4978,44.3333 44.3333,41.4978 44.3333,38C 44.3333,34.5022 41.4978,31.6667 38,31.6667 Z "/>
                                        </Button>
-->
                                        <Button x:Name="MinButton" Grid.Column="3" Style="{StaticResource MTitleBarButtonStyle}"
                                                >
                                            <Grid MaxHeight="9" MaxWidth="9">
                                                <Path
                                                Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                StrokeThickness="1"
                                                Stretch="None"
                                                RenderOptions.EdgeMode="Aliased"
                                                Data="M0,8 H8 M0,7 H8 M0,6 H8"
                                                />
                                            </Grid>
                                        </Button>

                                        <Button Grid.Column="4" x:Name="MaxButton" Style="{StaticResource MTitleBarButtonStyle}" >
                                            <Grid MaxHeight="9" MaxWidth="9">
                                                <Path
                                                x:Name="PART_MaxButton_Path"
                                                Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                StrokeThickness="1"
                                                Stretch="None"
                                                RenderOptions.EdgeMode="Aliased"
                                                Data="M0,0 H8 V8 H0 V0 M0,1 H8 M0,2 H8"
                                                />
                                            </Grid>
                                        </Button>

                                        <Button Grid.Column="5" x:Name="CloseButton" Style="{StaticResource MTitleBarButtonStyle}"                                                
                                                >
                                            <Grid MaxHeight="9" MaxWidth="9">
                                                <Path
                                                Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                StrokeThickness="1.5"
                                                Stretch="None"
                                                Data="M0,0 L8,8 M0,8 L8,0"
                                                />
                                            </Grid>
                                        </Button>
                                    </Grid>
                                </Border>
                                <Grid Background="Transparent">
                                    <ContentPresenter />
                                <!--    <local:ASide Visibility="{Binding WithASide, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}"/>-->
                                </Grid>
                            </DockPanel>
                        </Border>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="WindowState" Value="Maximized">
                            <Setter TargetName="PART_MaxButton_Path" Property="Data" Value="M0,3 H5 V8 H0 V3 M0,4 H5 M3,0 H8 V5 H7 M3,1 H8"/>
                        </Trigger>
                        <Trigger Property="ResizeMode" Value="NoResize">
                            <Setter TargetName="MinButton" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="MaxButton" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="StatusBar" Property="Visibility" Value="Collapsed"/>
                        </Trigger>
                        <Trigger Property="ResizeMode" Value="CanMinimize">
                            <Setter TargetName="MaxButton" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="StatusBar" Property="Visibility" Value="Collapsed"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    
</ResourceDictionary>